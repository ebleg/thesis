\chapter{Geometry of Lagrangian Mechanics}
\label{app:symplectic_geometry}

Just like the cotangent bundle, the tangent bundle admits a canonical structure, which is called the \emph{vertical endomorphism}. Its construction is slightly more convoluted than the canonical symplectic structure of the cotangent bundle, but nevertheless essential for a proper geometric interpretation of Lagrangian mechanics. 

\paragraph{The vertical endomorphism} The \emph{double tangent bundle} is the tangent bundle to $\tbundle{M}$, denoted by $\tbundle{(\tbundle{M})}$. This space has not one but two canonical vector bundle structures, defined by projection maps from $\tbundle{(\tbundle{M})} \to \tbundle{M}$. First, there is the trivial projection $\pi_{\tbundle{M}}$ thats `forgets' about the tangent elements to $\tbundle{M}$. Secondly, there is $ (\pi_{M})_* $ the pushforward (tangent map) of the projection map $\pi_M: \tbundle{M} \to M$. \cite{Abraham1978}
\begin{center}
   \begin{tikzcd} 
                    & \tbundle{(\tbundle{M})} \arrow[rd, "\pi_{\tbundle{M}}"] \arrow[ld, swap, "(\pi_M)_*"] & \\
        \tbundle{M} \arrow[rd, swap, "\pi_M"] &   & \tbundle{M} \arrow[ld, "\pi_M"] \\
                    & M        &  
   \end{tikzcd}
\end{center}
Vectors on the tangent bundle $\tbundle{M}$ (they live in $\tbundle{(\tbundle{M})}$) are called vertical if they vanish under the action of $ (\pi_M)_* $. These vectors point entirely in the `direction' of the fiber: in the Lagrangian formalism, they reflect a pure change in velocity, and no change in the generalized position. The \emph{vertical lift} $\Psi$ maps a vector on $M$ to a vertical vector on $\tbundle{M}$. \cite{Carinena1990}
\begin{equation}
    \begin{split}
        \Psi_{\vec{v}}: \tspace{q}{M} \to & \tspace{\vec{v}}{\qty(\tspace{q}{M})}: \\ 
        & \Psi_{\vec{v}}(\vec{w})\,f = \left. \dv{}{t} f(\vec{v} + t\vec{w})\right |_{t = 0}
        \qquad q \in M,\:\: \vec{v},\vec{w}\in \tspace{q}{M},\:\: f \in \functions{\tbundle{M}}.
    \end{split}
\end{equation}
In components, the effect of the vertical lift is as follows:
$$\Psi_{\vec{v}}: \quad \vec{w} = \left. w_i \pdv{}{q_i}\right|_q \quad \mapsto \quad  \Psi_{\vec{v}}(\vec{w}) = \left.w_i \pdv{}{v_i}\right|_{(q, \vec{v})}. $$
The vertical lift can also lift entire sections of $\tbundle{M}$ by simply applying the vertical lift pointwise.

Using the concept of the vertical lift, we can define the \emph{vertical isomorphism} $S$ from the double tangent bundle to itself, first by projecting with $(\pi_M)_*$ and then lifting again:
$$ S: \tbundle{\qty(\tbundle{M})} \to \tbundle{\qty(\tbundle{M})}: \quad S(q, \vec{v})\,u = \qty(\Psi_{\vec{v}} \circ (\pi_M)_*)\,u \qquad u \in \tspace{(q, \vec{v})}{\tbundle{M}}.  $$
The action of $S$ can also be stated in the form of the following diagram:
\begin{center}
   \begin{tikzcd} 
        \tbundle{(\tbundle{M})} \arrow[d, swap, "(\pi_M)_*"] \arrow[r, "S"] & \tbundle{(\tbundle{M})} \\
        \tbundle{M} \arrow[r, swap, "\mathrm{id}_{\tbundle{M}}"] &  \tbundle{M} \arrow[swap, u, "\Psi"]  \\
   \end{tikzcd}.
\end{center}
The action of the vertical endomorphism on the chart-induced basis is:
$$ S: \quad \left. \pdv{}{q_i}\right|_{(q, \vec{v})} \mapsto \left.\pdv{}{v_i}\right|_{(q, \vec{v})} \qquad  \left. \pdv{}{v_i}\right|_{(q, \vec{v})} \mapsto 0. $$
The vertical isomorphism is therefore a tensor of valence (1, 1) --- it takes a vector and produces another. Locally, $S$ can be expressed as:
$$ S = \pdv{}{v_i}\otimes \dd{q_i}. $$
%<symbol: \otimes> <expl: Tensor product> <tags: math, misc>
with $\otimes$ being the tensor product. \cite{Carinena1990}

The Lagrangian formalism only applies to second-order vector fields. A second-order vector field is a vector field $X$ such that $(\pi_M \circ X) = \mathrm{id}_{\tbundle{M}}$; i.e. the following diagram commutes: \cite{Abraham1978}
\begin{center}
   \begin{tikzcd} 
                    & \tbundle{(\tbundle{M})} \arrow[ld, swap, "(\pi_M)_*"] & \\
        \tbundle{M} \arrow[rr, swap, "\mathrm{id}_{\tbundle{M}}"] &   & \tbundle{M} \arrow[swap, lu, "X"]  \\
   \end{tikzcd}.
\end{center}
The identity on $\tbundle{M}$ is $\mathrm{id}_{\tbundle{M}}: (q, \vec{v}) \mapsto (q, \vec{v})$. Therefore, for a vector field $X$ to be second order, we should have that the component in $\pdv{}{q_i}$ that is picked out by $(\pi_M)_*$ should be equal to $v_i$; for example
$$ X = \sum_{i=1}^n \qty[v_i \pdv{q_i} + F_i\pdv{v_i}]. $$
The corresponding differential equations are
$$ \dv{q_i}{t} = v_i \qquad \dv{v_i}{t} = F_i, $$
which means that the second-order vector field coincides with the notion of a 'second-order differential equation' in $q_i$.

\paragraph{The Euler-Lagrange equations} With the infrastructure set up in the preceding paragraph, we can now define the precise geometric setting of Lagrangian mechanics. Given a Lagrangian function $L \in \functions{\tbundle{M}}$, define the \emph{Lagrange 1-form}\footnote
{\citet{Carinena1990} calls $\theta$ the Euler-Poincar√© 1-form.}
\begin{equation}
    \theta_L \equiv \dd{L} \circ S = \sum_{j=1}^n \pdv{L}{v^j}\dd{q^j}.
\end{equation}
Observe that the Lagrange 1-form is also equal to the pullback of the Liouville form under the Legendre transformation: $\theta_L = (\fiberder{L})^* \theta$. \cite{Abraham1978}
Secondly, we define the \emph{Lagrange 2-form} as: \cite{Abraham1978,Carinena1990}
\begin{equation}
    \omega_L \equiv - \dd{\theta}_L = \pdv[2]{L}{v^i}{v^j}\wedgep{\dd{q^j}}{\dd{v^i}} + \pdv[2]{L}{q^i}{v^j}\wedgep{\dd{q^j}}{\dd{q^i}}.
\end{equation}
Because the exterior derivative and the pullback commute, the Lagrange 2-form is equal to the pullback of the symplectic 2-form under the Legendre transform. If the rank of the Hessian $ \pdv[2]{L}{v^i}{v^j}$ is full (and constant), then $\omega_L$ is nondegenerate and therefore defines a symplectic structure on $\tbundle{M}$. However, observe that whether $\omega_L$ is symplectic or not depends on the nature of the Lagrangian, while the symplectic structure in the Hamiltonian setting is canonically derived from the cotangent bundle itself --- there is no need for the Hamiltonian to be regular.

The final ingredient for the Euler-Lagrange equations is the \emph{energy function}
$$ E \equiv Z(L) - L, $$
where $Z = \sum v^i \pdv{}{v^i}$ is the Liouville vector field on $\tbundle{M}$.

The \emph{Lagrangian vector field} $X_L$ is then the unique vector field that satisfies the equation: \cite{Godbillon1969}
\begin{equation}
    \intpr{X_L}{\omega_L} = \dd{E},
    \label{eq:EL_nocomp}
\end{equation}
In components, the right hand side of this equation is:
\begin{equation}
    \begin{split}
        \dd{E} &= \sum_{i, j}\qty(\pdv[2]{L}{v_j}{q_i}v_j\dd{q_i} + \pdv[2]{L}{v_j}{v_i}v_j\dd{v_i} + \pdv{L}{v_j}\dd{v_j}) - \dd{L}, \\
        \dd{E} &= \sum_{i, j}\qty(\pdv[2]{L}{v_j}{q_i}v_j\dd{q_i} + \pdv[2]{L}{v_j}{v_i}v_j\dd{v_i} - \pdv{L}{q_j}\dd{q_j}).
    \end{split}
    \label{eq:dE}
\end{equation}
Let $X_L = \sum_i \qty( A_i \pdv{}{q_i} + B_i\pdv{}{v_i}) $; the left hand side can then be written as follows:
\begin{equation}
    \intpr{X_L}{\omega_L} =  - \sum_{i,j} A_i \pdv[2]{L}{q_i}{v_j}\dd{q_j} 
                             + \sum_{i,j} A_j \pdv[2]{L}{q_i}{v_j}\dd{q_i} 
                             - \sum_{i, j} B_i \pdv[2]{L}{v_i}{v_j}\dd{q_j}
                             + \sum_{i, j} A_j \pdv[2]{L}{v_i}{v_j}\dd{v_i}.
\end{equation}
Comparing this expression with \cref{eq:dE}, it is immediately clear that
$$ A_j \pdv[2]{L}{v_i}{v_j} = v_j \pdv[2]{L}{v_i}{v_j}.$$
We therefore have that $A_j = v_j$, but \emph{only} if the Hessian of $L$ with respect to the velocities is nonsingular. If this is indeed the case (i.e. $L$ is regular), and the condition implies that the vector field $X_L$ is second-order. We can use this knowledge to obtain a second condition (since the terms in $\dd{q_i}$ cancel): 
$$
    \sum_{i} B_i \pdv[2]{L}{v_i}{v_j} = \pdv{L}{q_j} - \sum_{i} v_i \pdv[2]{L}{q_i}{v_j}.  
$$
The Hessian of $L$ in the velocities $M_{ij} = \pdv[2]{L}{v_i}{v_j}$ is also called the mass matrix of the system. We have already assumed that this matrix is invertible (i.e. $L$ is regular). As such, we have that
$$ \sum_{i}\pdv[2]{L}{v_i}{v_j}\dv[2]{q_j}{t} + \sum_{i} \pdv[2]{L}{q_i}{v_j}\dv{q_i}{t} = \pdv{L}{q_j}, $$
or equivalently
$$ \dv{}{t}\qty(\pdv{L}{v_j}) - \pdv{L}{q_j} = 0, $$
which is the traditional form of the Euler-Lagrange equations.

Provided that $X_L$ is a second-order vector field, the equation \cref{eq:EL_nocomp} is equivalent to the following statement:
\begin{equation}
    \lied{X_L}{\theta_L} = \dd{L}.
\end{equation}
The equivalence is easily shown using the Cartan formula:
\begin{equation*}
    \begin{split}
        \lied{X_L}{\theta_L} &= \dd{L} \\
        \dd{\qty(\intpr{X_L}{\theta_L})} + \intpr{X_L}{\dd{\theta_L}} &= \dd{L} \\
        \dd{\qty(\intpr{X_L}{\theta_L})} - \intpr{X_L}{\omega_L} &= \dd{L}
    \end{split}
\end{equation*}
The fact that $X_L$ is second-order implies that $\intpr{X_L}{\theta_L} = Z(L)$. Therefore 
\begin{equation*}
    \begin{split}
        \dd{(Z(L))} - \intpr{X_L}{\omega_L} &= \dd{L} \\
        \intpr{X_L}{\omega_L} &= \dd{Z(L) - L} \\
        \intpr{X_L}{\omega_L} &= \dd{E}.
    \end{split}
\end{equation*}
Lagrangians are not unique: from \cref{eq:EL_nocomp} we can deduce that the addition of a closed 1-form (as a map from $\tbundle{M} \to \real$) to the Lagrangian will not alter the Euler-Lagrange equations. The closed 1-forms on $M$  therefore constitute the \emph{gauge group} of Lagrangian mechanics. An equivalent statement is that the Euler-Lagrange equations remain invariant if a total derivative is added to the Lagrangian function. \cite{Abraham1978}
